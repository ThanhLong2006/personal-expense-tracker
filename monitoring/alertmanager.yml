# Alertmanager - Cảnh báo khi server quá tải, lỗi 5xx
# Để bật Telegram/Email: chạy ./scripts/generate-alertmanager-config.sh
# sau khi set TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID, SMTP_* trong .env

global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'default-receiver'
  routes:
    - match:
        severity: critical
      receiver: 'critical-receiver'
      continue: true
    - match:
        severity: warning
      receiver: 'warning-receiver'

receivers:
  - name: 'default-receiver'
    # Thêm webhook, slack, etc. khi cần

  - name: 'critical-receiver'
    # BẬT CẢNH BÁO: Uncomment và điền thông tin, hoặc dùng generate-alertmanager-config.sh
    # Email (khi có SMTP_USER, SMTP_PASSWORD)
    # email_configs:
    #   - to: 'admin@yourdomain.com'
    #     from: 'alert@yourdomain.com'
    #     smarthost: 'smtp.gmail.com:587'
    #     auth_username: 'your-email@gmail.com'
    #     auth_password: 'your-app-password'
    #     headers:
    #       Subject: '[CRITICAL] Quản Lý Chi Tiêu - {{ .GroupLabels.alertname }}'
    #
    # Telegram (khi có TELEGRAM_BOT_TOKEN, TELEGRAM_CHAT_ID)
    # telegram_configs:
    #   - bot_token: 'YOUR_BOT_TOKEN'
    #     chat_id: YOUR_CHAT_ID
    #     parse_mode: 'HTML'

  - name: 'warning-receiver'
    # Tương tự - có thể dùng email hoặc Telegram

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
